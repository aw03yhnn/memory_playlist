<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ memory.title }} - Memory Playlist</title>
    <!-- Âü∫Êú¨ÁöÑ„Å™„Çπ„Çø„Ç§„É´ -->
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
        }
        .nav-buttons {
            display: flex;
            gap: 10px;
        }
        .back-btn {
            background: #666;
            color: white;
            padding: 12px 24px;
            text-decoration: none;
            border-radius: 25px;
            font-weight: bold;
            transition: background-color 0.3s;
        }
        .back-btn:hover {
            background: #555;
        }
        .create-btn {
            background: #1DB954;
            color: white;
            padding: 12px 24px;
            text-decoration: none;
            border-radius: 25px;
            font-weight: bold;
            transition: background-color 0.3s;
        }
        .create-btn:hover {
            background: #1ed760;
        }
        .memory-detail {
            background: white;
            border-radius: 8px;
            padding: 30px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .memory-title {
            color: #333;
            font-size: 2em;
            margin-bottom: 20px;
            border-bottom: 2px solid #1DB954;
            padding-bottom: 10px;
        }
        .memory-description {
            color: #555;
            line-height: 1.6;
            margin-bottom: 30px;
            font-size: 1.1em;
        }
        .song-section {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
        }
        .song-title {
            color: #333;
            font-size: 1.3em;
            margin-bottom: 5px;
        }
        .artist-name {
            color: #666;
            font-size: 1.1em;
            margin-bottom: 15px;
        }
        .spotify-player {
            margin: 20px 0;
            border-radius: 8px;
            overflow: hidden;
        }
        .spotify-link {
            display: inline-block;
            background: #1DB954;
            color: white;
            padding: 12px 24px;
            text-decoration: none;
            border-radius: 25px;
            font-weight: bold;
            transition: background-color 0.3s;
        }
        .spotify-link:hover {
            background: #1ed760;
        }
        .weekly-chart-section {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 8px;
            padding: 25px;
            margin: 30px 0;
            color: white;
        }
        .chart-title {
            font-size: 1.4em;
            margin-bottom: 15px;
            text-align: center;
        }
        .chart-subtitle {
            font-size: 1em;
            margin-bottom: 20px;
            text-align: center;
            opacity: 0.9;
        }
        .chart-track {
            display: flex;
            align-items: center;
            padding: 12px;
            margin-bottom: 8px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 6px;
            transition: background-color 0.3s;
        }
        .chart-track:hover {
            background: rgba(255, 255, 255, 0.2);
        }
        .chart-rank {
            font-size: 1.2em;
            font-weight: bold;
            margin-right: 15px;
            min-width: 30px;
        }
        .chart-track-info {
            flex: 1;
        }
        .chart-track-title {
            font-weight: bold;
            margin-bottom: 2px;
        }
        .chart-track-artist {
            font-size: 0.9em;
            opacity: 0.8;
        }
        .chart-playcount {
            font-size: 0.8em;
            opacity: 0.7;
        }
        .share-section {
            margin-top: 30px;
            padding-top: 20px;
            border-top: 1px solid #eee;
        }
        .share-title {
            color: #333;
            font-size: 1.2em;
            margin-bottom: 15px;
        }
        .share-buttons {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }
        .share-btn {
            display: inline-block;
            padding: 8px 16px;
            text-decoration: none;
            border-radius: 20px;
            font-size: 14px;
            font-weight: bold;
            transition: opacity 0.3s;
        }
        .share-btn:hover {
            opacity: 0.8;
        }
        .twitter-btn {
            background: #1DA1F2;
            color: white;
        }
        .facebook-btn {
            background: #4267B2;
            color: white;
        }
        .line-btn {
            background: #00B900;
            color: white;
        }
        .date {
            color: #999;
            font-size: 0.9em;
            margin-top: 20px;
            text-align: center;
        }
        h1 {
            color: #333;
            margin: 0;
        }
    </style>
    <script>
        // Spotify URL„Åã„Çâ„Éà„É©„ÉÉ„ÇØID„ÇíÊäΩÂá∫„Åô„ÇãÈñ¢Êï∞
        function extractTrackId(url) {
            const pattern = /spotify\.com\/.*\/track\/([a-zA-Z0-9]+)/;
            const match = url.match(pattern);
            return match ? match[1] : null;
        }
        
        // „Éö„Éº„Ç∏Ë™≠„ÅøËæº„ÅøÊôÇ„Å´„Éà„É©„ÉÉ„ÇØID„ÇíÊäΩÂá∫„Åó„Å¶„Éó„É¨„Éº„É§„Éº„ÇíË°®Á§∫
        window.onload = function() {
            const spotifyUrl = "{{ memory.spotify_url }}";
            if (spotifyUrl) {
                const trackId = extractTrackId(spotifyUrl);
                if (trackId) {
                    const playerContainer = document.getElementById('spotify-player-container');
                    playerContainer.innerHTML = `
                        <iframe 
                            style="border-radius:12px" 
                            src="https://open.spotify.com/embed/track/${trackId}?utm_source=generator" 
                            width="100%" 
                            height="152" 
                            frameborder="0" 
                            allowfullscreen="" 
                            allow="autoplay; clipboard-write; encrypted-media; fullscreen; picture-in-picture" 
                            loading="lazy">
                        </iframe>
                    `;
                }
            }
        };
    </script>
</head>
<body>
    <!-- „Éò„ÉÉ„ÉÄ„ÉºÈÉ®ÂàÜ -->
    <div class="header">
        <h1>Memory Playlist</h1>
        <div class="nav-buttons">
            <a href="{% url 'memolog:memory_list' %}" class="back-btn">‚Üê Back to Memories</a>
            <a href="{% url 'memolog:memory_create' %}" class="create-btn">+ Share Memory</a>
        </div>
    </div>
    
    <!-- Ë®òÊÜ∂„ÅÆË©≥Á¥∞„ÇíË°®Á§∫ -->
    <div class="memory-detail">
        <h2 class="memory-title">{{ memory.title }}</h2>
        <p class="memory-description">{{ memory.description }}</p>
        
        <div class="song-section">
            <h3 class="song-title">{{ memory.song_title }}</h3>
            <p class="artist-name">by {{ memory.artist_name }}</p>
            
            <!-- SpotifyÂüã„ÇÅËæº„Åø„Éó„É¨„Éº„É§„Éº -->
            {% if memory.spotify_url %}
                <div class="spotify-player" id="spotify-player-container">
                    <!-- JavaScript„ÅßÂãïÁöÑ„Å´„Éó„É¨„Éº„É§„Éº„ÇíÁîüÊàê -->
                </div>
            {% endif %}
            
            <a href="{{ memory.spotify_url }}" class="spotify-link" target="_blank">
                üéµ Open in Spotify
            </a>
        </div>
        
        <!-- ÈÄ±Èñì„ÉÅ„É£„Éº„Éà„Çª„ÇØ„Ç∑„Éß„É≥ -->
        {% if weekly_chart %}
        <div class="weekly-chart-section">
            <h3 class="chart-title">üéµ That Week's Top Hits</h3>
            <p class="chart-subtitle">What everyone else was listening to when you shared this memory</p>
            
            {% for track in weekly_chart %}
            <div class="chart-track">
                <div class="chart-rank">#{{ track.rank }}</div>
                <div class="chart-track-info">
                    <div class="chart-track-title">{{ track.title }}</div>
                    <div class="chart-track-artist">{{ track.artist }}</div>
                </div>
                <div class="chart-playcount">{{ track.playcount }} plays</div>
            </div>
            {% endfor %}
        </div>
        {% endif %}
        
        <!-- SNS„Ç∑„Çß„Ç¢„Çª„ÇØ„Ç∑„Éß„É≥ -->
        <div class="share-section">
            <h4 class="share-title">Share this memory:</h4>
            <div class="share-buttons">
                <a href="https://twitter.com/intent/tweet?text={{ memory.title|urlencode }} - {{ memory.song_title }} by {{ memory.artist_name }}&url={{ request.build_absolute_uri }}" 
                   class="share-btn twitter-btn" target="_blank">
                    üê¶ Twitter
                </a>
                <a href="https://www.facebook.com/sharer/sharer.php?u={{ request.build_absolute_uri }}" 
                   class="share-btn facebook-btn" target="_blank">
                    üìò Facebook
                </a>
                <a href="https://social-plugins.line.me/lineit/share?url={{ request.build_absolute_uri }}" 
                   class="share-btn line-btn" target="_blank">
                    üí¨ LINE
                </a>
            </div>
        </div>
        
        <div class="date">
            Posted on {{ memory.created_at|date:"F j, Y" }}
        </div>
    </div>
</body>
</html> 